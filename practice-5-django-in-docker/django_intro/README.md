# Комп'ютерний практикум 4

### Запуск web додатків у контейнерах

### Інсталяція Docker

Для початку необхідно встановити docker. Його можна знайти за адресою https://www.docker.com/ \
На сайті можна завантажити інсталятор для Windows та MacOS, який майже автоматично встановить усі необхідні
компоненти. У випадку, якщо Ви користуєтеся linux, достатньо буде встановити docker за допомогою
пакетного менеджера вашого дистрибутиву. Для Ubuntu команда виглядатиме приблизно так:

`sudo apt-get install docker`

Для RHEL-based систем (Red Hat Enterprise Linux, Fedora)

`yum install docker`

### Збирання та запуск образу

Для розміщення у docker необхідно зібрати контейнер. Для цього спочатку необхідно створити Dockerfile, \
що описує послідовність дій для збирання контейнеру. Приклад такого файлу можна знайти у даному репозиторії.

Після створення docker файлу необхідно запустити процесс збирання образу. Зробити це можна за допомогою команди:

`docker build -t <назва образу>:<тег (latest чи номер версії)> .`

При цьому робиться припущення, що командний рядок запущено у папці, де розміщенно Dockerfile. Інакше, задати розміщення
Dockerfile можна за допомогою параметра -f=<відносний шлях до файлу>

Запустити контейнер з образу можна за допомогою команди

`docker run --name=<ім'я контейнеру> -p <номер порту контейнеру>:<номер порту хоста> <назва образу>:<тег (latest чи номер версії)> `

### Оркестрація

Оркестрацію у даній роботі може бути організовано за допомогою docker compose або kubernetes.\
Для docker compose спочатку необхідно створити yaml файл з описом сервісів. Приклад docker-compose.yml також
можна знайти у даному репозиторії.

Запустити docker-compose можна за допомогою команди

`docker compose up -d`

Запустити один вказаний сервіс можна за допомогою команди

`docker compose up -d <назва сервісу>`

**Важливо!** Посилання на усі сторонні сервіси мають передаватись до додатку через змінні оточення (environment variables), інакше є шанс того, що адреса у коді
буде некоректною. У даному репозиторії можна знайти приклад такої передачі при використанні Redis (views.py)

У випадку з kubernetes спочатку треба встановити утиліту minikube для створення мінімалістичного кластеру. Після створення
такого кластеру можна керувати k8s за допомогою утиліти kubectl. Далі необхідно сторити yaml описи pod'ів. Приклади опису можна знайти у папці k8s

Застосувати зміни із yaml файлу можна за допомогою команди:

`kubectl apply -f=<шлях до yaml файлу>`

Далі необхідно створити сервіс для доступу до pod'y. Для цього треба виконати команду:

`kubectl expose pod <ім'я pod> --type=LoadBalancer --port=<порт для доступу ззовні>`

Дана команда створить service із типом LoadBalancer і зробить його доступним ззовні на вказаному порті. **Важливо!**
Для доступу до кластеру у minikube необіхдно запустити у окремій консолі команду:

`minikube tunnel`

Після виконання команди, кластер буде доступний за адресою 127.0.0.1.

### Додаткові посилання
https://www.docker.com/ - сайт проекту Docker\
https://docs.docker.com/compose/ - документація по docker compose\
https://docs.docker.com/develop/develop-images/dockerfile_best-practices/ - керіництво з написання Dockerfile\
https://minikube.sigs.k8s.io/docs/start/ - керівництво із встановлення та запуску minikube\
